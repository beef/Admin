(function(){var b=tinymce.each;tinymce.create("tinymce.plugins.PastePlugin",{init:function(l,k){var j=this,a;j.editor=l;j.url=k;j.onPreProcess=new tinymce.util.Dispatcher(j);j.onPostProcess=new tinymce.util.Dispatcher(j);j.onPreProcess.add(j._preProcess);j.onPostProcess.add(j._postProcess);j.onPreProcess.add(function(d,c){l.execCallback("paste_preprocess",d,c)});j.onPostProcess.add(function(d,c){l.execCallback("paste_postprocess",d,c)});function h(c){var d=l.dom;j.onPreProcess.dispatch(j,c);c.node=d.create("div",0,c.content);j.onPostProcess.dispatch(j,c);c.content=l.serializer.serialize(c.node,{getInner:1});if(/<(p|h[1-6]|ul|ol)/.test(c.content)){j._insertBlockContent(l,d,c.content)}else{j._insert(c.content)}}l.addCommand("mceInsertClipboardContent",function(d,c){h(c)});function i(d){var q,e,g,f=l.selection,r=l.dom,n=l.getBody(),c;if(r.get("_mcePaste")){return}q=r.add(n,"div",{id:"_mcePaste"},"\uFEFF");if(n!=l.getDoc().body){c=r.getPos(l.selection.getStart(),n).y}else{c=n.scrollTop}r.setStyles(q,{position:"absolute",left:-10000,top:c,width:1,height:1,overflow:"hidden"});if(tinymce.isIE){g=r.doc.body.createTextRange();g.moveToElementText(q);g.execCommand("Paste");r.remove(q);if(q.innerHTML==="\uFEFF"){l.execCommand("mcePasteWord");d.preventDefault();return}h({content:q.innerHTML});return tinymce.dom.Event.cancel(d)}else{e=l.selection.getRng();q=q.firstChild;g=l.getDoc().createRange();g.setStart(q,0);g.setEnd(q,1);f.setRng(g);window.setTimeout(function(){var m="",o=r.select("div[id=_mcePaste]");b(o,function(p){m+=(r.select("> span.Apple-style-span div",p)[0]||r.select("> span.Apple-style-span",p)[0]||p).innerHTML});b(o,function(p){r.remove(p)});if(e){f.setRng(e)}h({content:m})},0)}}if(l.getParam("paste_auto_cleanup_on_paste",true)){if(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)){l.onKeyDown.add(function(d,c){if(((tinymce.isMac?c.metaKey:c.ctrlKey)&&c.keyCode==86)||(c.shiftKey&&c.keyCode==45)){i(c)}})}else{l.onPaste.addToTop(function(d,c){return i(c)})}}if(l.getParam("paste_block_drop")){l.onInit.add(function(){l.dom.bind(l.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(c){c.preventDefault();c.stopPropagation();return false})})}j._legacySupport()},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(m,h){var a=this.editor,n=h.content,j,k;function j(c){b(c,function(d){if(d.constructor==RegExp){n=n.replace(d,"")}else{n=n.replace(d[0],d[1])}})}if(/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(n)||h.wordContent){h.wordContent=true;j([/^\s*(&nbsp;)+/g,/(&nbsp;|<br[^>]*>)+\s*$/g]);if(a.getParam("paste_convert_middot_lists",true)){j([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+:\s*symbol[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<span[^>]+mso-list:[^>]+>)/gi,"$1__MCE_ITEM__"]])}j([/<!--[\s\S]+?-->/gi,/<\/?(img|font|meta|link|style|div|v:\w+)[^>]*>/gi,/<\\?\?xml[^>]*>/gi,/<\/?o:[^>]*>/gi,/ (id|name|language|type|on\w+|v:\w+)=\"([^\"]*)\"/gi,/ (id|name|language|type|on\w+|v:\w+)=(\w+)/gi,[/<(\/?)s>/gi,"<$1strike>"],/<script[^>]+>[\s\S]*?<\/script>/gi,[/&nbsp;/g,"\u00a0"]]);if(!a.getParam("paste_retain_style_properties")){j([/<\/?(span)[^>]*>/gi])}}k=a.getParam("paste_strip_class_attributes");if(k!="none"){function l(c,f){var d,e="";if(k=="all"){return""}f=tinymce.explode(f," ");for(d=f.length-1;d>=0;d--){if(!/^(Mso)/i.test(f[d])){e+=(!e?"":" ")+f[d]}}return' class="'+e+'"'}j([[/ class=\"([^\"]*)\"/gi,l],[/ class=(\w+)/gi,l]])}if(a.getParam("paste_remove_spans")){j([/<\/?(span)[^>]*>/gi])}h.content=n},_postProcess:function(j,h){var k=this,l=k.editor,i=l.dom,a;if(h.wordContent){b(i.select("a",h.node),function(c){if(!c.href||c.href.indexOf("#_Toc")!=-1){i.remove(c,1)}});if(k.editor.getParam("paste_convert_middot_lists",true)){k._convertLists(j,h)}a=l.getParam("paste_retain_style_properties");if(tinymce.is(a,"string")){a=tinymce.explode(a)}b(i.select("*",h.node),function(d){var c={},f=0,e,o,g;if(a){for(e=0;e<a.length;e++){o=a[e];g=i.getStyle(d,o);if(g){c[o]=g;f++}}}i.setAttrib(d,"style","");if(a&&f>0){i.setStyles(d,c)}else{if(d.nodeName=="SPAN"&&!d.className){i.remove(d,true)}}})}if(l.getParam("paste_remove_styles")||(l.getParam("paste_remove_styles_if_webkit")&&tinymce.isWebKit)){b(i.select("*[style]",h.node),function(c){c.removeAttribute("style");c.removeAttribute("mce_style")})}else{if(tinymce.isWebKit){b(i.select("*",h.node),function(c){c.removeAttribute("mce_style")})}}},_convertLists:function(q,s){var o=q.editor.dom,p,l,t=-1,r,a=[],m,n;b(o.select("p",s.node),function(f){var i,e="",g,h,d,c;for(i=f.firstChild;i&&i.nodeType==3;i=i.nextSibling){e+=i.nodeValue}e=f.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,"\u00a0");if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o]\s*\u00a0*/.test(e)){g="ul"}if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0{2,}/.test(e)){g="ol"}if(g){r=parseFloat(f.style.marginLeft||0);if(r>t){a.push(r)}if(!p||g!=m){p=o.create(g);o.insertAfter(p,f)}else{if(r>t){p=l.appendChild(o.create(g))}else{if(r<t){d=tinymce.inArray(a,r);c=o.getParents(p.parentNode,g);p=c[c.length-1-d]||p}}}b(o.select("span",f),function(j){var k=j.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");if(g=="ul"&&/^[\u2022\u00b7\u00a7\u00d8o]/.test(k)){o.remove(j)}else{if(/^[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(k)){o.remove(j)}}});h=f.innerHTML;if(g=="ul"){h=f.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o]\s*(&nbsp;|\u00a0)+\s*/,"")}else{h=f.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,"")}l=p.appendChild(o.create("li",0,h));o.remove(f);t=r;m=g}else{p=t=0}});n=s.node.innerHTML;if(n.indexOf("__MCE_ITEM__")!=-1){s.node.innerHTML=n.replace(/__MCE_ITEM__/g,"")}},_insertBlockContent:function(r,u,q){var w,s,v=r.selection,a,p,x,o,t;function n(c){var d;if(tinymce.isIE){d=r.getDoc().body.createTextRange();d.moveToElementText(c);d.collapse(false);d.select()}else{v.select(c,1);v.collapse(false)}}this._insert('<span id="_marker">&nbsp;</span>',1);s=u.get("_marker");w=u.getParent(s,"p,h1,h2,h3,h4,h5,h6,ul,ol,th,td");if(w&&!/TD|TH/.test(w.nodeName)){s=u.split(w,s);b(u.create("div",0,q).childNodes,function(c){a=s.parentNode.insertBefore(c.cloneNode(true),s)});n(a)}else{u.setOuterHTML(s,q);v.select(r.getBody(),1);v.collapse(0)}u.remove("_marker");p=v.getStart();x=u.getViewPort(r.getWin());o=r.dom.getPos(p).y;t=p.clientHeight;if(o<x.y||o+t>x.y+x.h){r.getDoc().body.scrollTop=o<x.y?o:o-x.h+25}},_insert:function(e,a){var f=this.editor;if(!f.selection.isCollapsed()){f.getDoc().execCommand("Delete",false,null)}f.execCommand(tinymce.isGecko?"insertHTML":"mceInsertContent",false,e,{skip_undo:a})},_legacySupport:function(){var d=this,a=d.editor;b(["mcePasteText","mcePasteWord"],function(c){a.addCommand(c,function(){a.windowManager.open({file:d.url+(c=="mcePasteText"?"/pastetext.htm":"/pasteword.htm"),width:parseInt(a.getParam("paste_dialog_width","450")),height:parseInt(a.getParam("paste_dialog_height","400")),inline:1})})});a.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});a.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"});a.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"})}});tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin)})();